The installation of amusewiki takes time (depending on speed of the
machine and of the network) and requires about 4Gb of disk space,
mostly because of the installation of TeXlive. Otherwise the procedure
is fully automated, so start it, check if it bails out at the
beginning, forget about it for an hour or two (run it under screen),
then come back later and finish it up to complete it for the
operations which require root privileges (notably the webserver
configuration). The last lines of output is what matters. It will tell
you about the needed changes to the $PATH for TeXlive, and where to
login. From there you should be be able to create and configure new
sites from the admin console under /admin/sites.

The supported and recommended setup is nginx + FCGI. The FCGI setup
should work with Apache as well, but it's not currently actively
supported. perldoc Catalyst::Manual::Deployment::Apache::FastCGI
should help, though.

Prerequisites:

 - a database (mysql, pg, sqlite are supported)
 - a working perl (i.e., you can install modules)
 - fontconfig (install it before installing texlive)
 - graphicsmagick (for thumbnails) and imagemagick (for preview generation)
 - a mime-info database: shared-mime-info on debian
 - fcgiwrap running and listening to /var/run/fcgiwrap.socket (as in debian)
 - a dedicated system user (with a clean home) which is going to run the site

Log in as the user you want to run the site.

Unpack the sources (or clone the repo) and change directory into them.

Create a database for the application. E.g., for mysql:

  mysql> create database amuse DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
  mysql> grant all privileges on amuse.* to amuse@localhost identified by XXX

Or, for postgres:

Login as root.

 su - postgres
 psql
 create user amuse with password 'XXXX';
 create database amuse owner amuse;

For sqlite no setup is required.

Copy dbic.yaml.<dbtype>.example to dbic.yaml and adjust the
credentials, and chmod it to 600. (For sqlite is good as it is).

Please note that the installation procedure will create a mirror of
amusewiki.org under the subdomain amusewiki.<your domain>, where <your
domain> is the output of `hostname -d`. Nothing you can't change later
from the admin console, but you need to access it.

Execute:

./script/install.sh

The script is going to take care of the installation in a
non-interactive fashion, picking resonable defaults.

The output is copious, but you need only the last lines. Setting up
the $PATH is crucial.

To start/stop/restart the application:

./init-all start
./init-all stop
./init-all restart

OPTIONAL SETUP

Make the repositories read-only available via git-daemon.

  apt-get install git-daemon-sysvinit

Change /etc/default/git-daemon to read:

  GIT_DAEMON_ENABLE=true

Start the service

  service git-daemon start

Link the repositories in /var/cache/git (as per package documentation).
Note that in debian jessie it was moved to /var/lib/cache).

Something like this should do:

root@localhost:/var/cache/git# for i in ~amuse/amusewiki/repo/*; \
     do if [ -d "$i/.git" ]; then echo $(basename $i); \
     ln -s $i/.git $(basename $i).git ; fi ; done

And in your repo directory, mark the repository for export:

amuse@localhost:~/amusewiki/repo$ for i in */.git ; do touch $i/git-daemon-export-ok; done

